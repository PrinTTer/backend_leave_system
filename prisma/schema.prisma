generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model calendar {
  calendar_id   Int                    @id @default(autoincrement())
  calendar_type calendar_calendar_type
  title         String                 @db.VarChar(100)
  start_date    DateTime               @db.Date
  end_date      DateTime               @db.Date
  total_day     Int
  description   String?                @db.Text
  update_at     DateTime               @updatedAt @db.Timestamp(0)
  create_at     DateTime               @default(now()) @db.Timestamp(0)
  is_holiday    Boolean?
}

model fact_form {
  fact_form_id  Int              @id @default(autoincrement())
  user_id       Int
  leave_type_id Int
  start_date    DateTime         @db.Date
  end_date      DateTime         @db.Date
  total_day     Float            @default(0) @db.Float
  fiscal_year   Int
  status        fact_form_status
  approve_date  DateTime         @db.Date
  note          String?          @db.VarChar(225)
  file_leave    String           @db.VarChar(45)
  update_at     DateTime         @updatedAt @db.Timestamp(0)
  create_at     DateTime         @default(now()) @db.Timestamp(0)
  approval      approval[]
  leave_type    leave_type       @relation(fields: [leave_type_id], references: [leave_type_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_fact_form_leave_type")

  @@index([leave_type_id], map: "fk_fact_form_leave_type1_idx")
}

model leave_approval_rule {
  leave_approval_rule_id Int        @id @default(autoincrement())
  leave_type_id          Int
  leave_less_than        Int
  approval_level         Int
  leave_type             leave_type @relation(fields: [leave_type_id], references: [leave_type_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_leave_approval_rule_leave_type1")

  @@index([leave_type_id], map: "fk_leave_approval_rule_leave_type1_idx")
}

model leave_type {
  leave_type_id       Int                   @id @default(autoincrement())
  name                String                @db.VarChar(100)
  gender              leave_type_gender     @default(all)
  is_count_vacation   Boolean               @default(false)
  service_year        Int
  number_approver     Int
  category            leave_type_category
  update_at           DateTime              @updatedAt @db.Timestamp(0)
  create_at           DateTime              @default(now()) @db.Timestamp(0)
  max_leave           Int
  fact_form           fact_form[]
  fact_leave_credit   fact_leave_credit[]
  leave_approval_rule leave_approval_rule[]
  leave_type_document leave_type_document[]
  vacation_rule       vacation_rule[]
}

model leave_type_document {
  leave_type_document_id Int                           @id @default(autoincrement())
  leave_type_id          Int
  name                   String                        @db.VarChar(100)
  file_type              leave_type_document_file_type
  is_required            Boolean                       @default(false)
  leave_type             leave_type                    @relation(fields: [leave_type_id], references: [leave_type_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_leave_type_document_leave_type1")

  @@index([leave_type_id], map: "fk_leave_type_document_leave_type1_idx")
}

model leave_visibility {
  leave_visibility_id Int      @id @default(autoincrement())
  viewer_user_id      Int
  target_user_id      Int
  created_by_user_id  Int?
  created_at          DateTime @default(now())
  @@unique([viewer_user_id, target_user_id], map: "uk_viewer_target")
  @@map("leave_visibility")
}

model vacation_rule {
  vacation_rule_id Int        @id @default(autoincrement())
  leave_type_id    Int
  service_year     Int
  annual_leave     Int
  max_leave        Int
  leave_type       leave_type @relation(fields: [leave_type_id], references: [leave_type_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_vacation_rule_leave_type1")

  @@index([leave_type_id], map: "fk_vacation_rule_leave_type1_idx")
}

model approval {
  user_id      Int
  approver_id  Int
  fact_form_id Int
  status       approval_status
  fact_form    fact_form       @relation(fields: [fact_form_id], references: [fact_form_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_approval_fact_form1")

  @@id([user_id, approver_id, fact_form_id])
  @@unique([user_id, approver_id, fact_form_id], map: "unique_user_approver_form")
  @@index([fact_form_id], map: "fk_approval_fact_form1_idx")
}

model fact_leave_credit {
  user_id       Int
  leave_type_id Int
  annual_leave  Float      @db.Float
  used_leave    Float      @db.Float
  left_leave    Float      @db.Float
  leave_type    leave_type @relation(fields: [leave_type_id], references: [leave_type_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_fact_leave_credit_leave_type1")

  @@id([user_id, leave_type_id])
  @@index([leave_type_id], map: "fk_fact_leave_credit_leave_type1_idx")
}

model requester {
  user_id        Int
  approver_id    Int
  approver_order Int

  @@unique([user_id, approver_id, approver_order], map: "user_id")
}

enum calendar_calendar_type {
  holiday
  academic
  fiscal
}

enum leave_type_gender {
  male
  female
  all
}

enum leave_type_document_file_type {
  pdf
  png
  doc
  jpg
}

enum leave_type_category {
  general
  vacation
}

enum fact_form_status {
  draft
  pending
  approve
  reject
  cancel
}

enum approval_status {
  approve
  reject
  pending
}
